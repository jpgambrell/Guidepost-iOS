openapi: 3.0.0
info:
  title: Analysis Service API
  version: 1.0.0
  description: Image analysis microservice with Kafka consumer integration
  contact:
    name: API Support

servers:
  - url: http://localhost:3001
    description: Development server

tags:
  - name: Analysis
    description: Image analysis endpoints
  - name: Health
    description: Health check endpoints

paths:
  /api/analysis:
    get:
      tags:
        - Analysis
      summary: Get all analysis results
      responses:
        '200':
          description: List of all analysis results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ImageAnalysisResult'

  /api/analysis/{imageId}:
    get:
      tags:
        - Analysis
      summary: Get analysis result for a specific image
      parameters:
        - in: path
          name: imageId
          required: true
          schema:
            type: string
            format: uuid
          description: The image ID
      responses:
        '200':
          description: Analysis result retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/ImageAnalysisResult'
        '404':
          description: Analysis result not found for this image

  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  kafka:
                    type: object
                    properties:
                      consumer:
                        type: string
                        enum:
                          - connected
                          - disconnected
                      producer:
                        type: string
                        enum:
                          - connected
                          - disconnected

components:
  schemas:
    ImageAnalysisResult:
      type: object
      properties:
        imageId:
          type: string
          format: uuid
          description: Image identifier
        filename:
          type: string
          description: Image filename
        analyzedAt:
          type: string
          format: date-time
          description: Analysis timestamp
        keywords:
          type: array
          items:
            type: string
          description: Keywords describing the image content
        detectedText:
          type: array
          items:
            type: string
          description: Text detected in the image
        description:
          type: string
          description: Overall description of the image
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
          description: Analysis status
        error:
          type: string
          description: Error message if analysis failed